# 中国法律统一知识图谱配置说明

## 📌 概述

本文档详细说明了为构建**中国法律统一知识图谱**而对 `config.yaml` 进行的配置优化方案。该方案的核心目标是建立一个能够统一处理**法律文书（判决书）、法律法规、司法解释、指导性案例、参考案例**五大文档源的知识图谱体系。

---

## 🎯 核心设计理念

### 1. 统一实体类型体系
将实体类型分为五大类别，涵盖五大文档源：

#### 📄 一、文档类型实体（Document Types）
- **LEGAL_DOCUMENT**: 法律文书统称
- **JUDGMENT**: 判决书（如 (2023)京01刑初123号）
- **RULING**: 裁定书
- **MEDIATION**: 调解书
- **GUIDING_CASE**: 指导性案例（如指导案例123号，具有指导意义和准约束力）⭐**新增**
- **REFERENCE_CASE**: 参考案例（如最高法公报案例、典型案例，具有参考价值）⭐**新增**
- **LAW**: 法律法规（如《中华人民共和国刑法》）
- **REGULATION**: 行政法规/部门规章
- **JUDICIAL_INTERPRETATION**: 司法解释（如《最高人民法院关于...的解释》）
- **NORMATIVE_DOCUMENT**: 规范性文件

**设计意图**：明确区分不同文档类型，特别是将指导性案例和参考案例作为独立文档类型，为跨文档关系建立基础

#### 🆔 特殊标识实体（新增）
- **GUIDING_CASE_NUMBER**: 指导性案例编号（如"指导案例123号"）⭐**新增**
- **REFERENCE_CASE_NUMBER**: 参考案例编号（如公报案例编号）⭐**新增**

**设计意图**：为指导性案例和参考案例提供唯一标识，便于跨文档引用和检索

#### 🔗 二、法规结构实体（Legal Structure）
- **ARTICLE**: 法条/条文
- **CLAUSE**: 款项
- **ITEM**: 项目
- **CHAPTER**: 章节

**设计意图**：构建法律文本的层级结构，支持精确到款项的引用

#### ⚖️ 三、案件实体（Case Entities）
- **CASE_NUMBER**: 案号（唯一标识）
- **PERSON**: 自然人/当事人（需区分角色）
- **ORG**: 机构组织
- **COURT**: 审判机关
- **PROCURATORATE**: 检察机关
- **LAWYER**: 律师/辩护人
- **JUDGE**: 审判人员

**设计意图**：完整表达案件参与主体及其角色

#### 📚 四、法律要素实体（Legal Elements）
- **CRIME**: 罪名
- **CAUSE_OF_ACTION**: 案由
- **PUNISHMENT**: 刑罚
- **LIABILITY**: 民事责任
- **LEGAL_CONCEPT**: 法律概念（如自首、累犯）
- **LEGAL_PRINCIPLE**: 法律原则
- **EVIDENCE**: 证据
- **EVIDENCE_TYPE**: 证据种类

**设计意图**：抽象法律核心要素，支持跨案件的法律推理

#### 🏷️ 五、元数据实体（Metadata）
- **TIME**: 时间
- **LOCATION**: 地点
- **ASSET**: 涉案金额/物品
- **ISSUING_AUTHORITY**: 发文机关
- **EFFECT_LEVEL**: 效力层级
- **VALIDITY_STATUS**: 时效状态

**设计意图**：追踪法律文件的来源、效力和时效性

---

### 2. 统一关系类型体系（8大类别）

#### 🔗 一、法规体系内关系（Intra-Legal System）
```yaml
- belongs_to: [ARTICLE] -> [LAW]          # 法条属于法律
- part_of: [CHAPTER] -> [LAW]            # 章节是法律的组成部分
- amends: [LAW] -> [LAW]                 # 修订关系
- repeals: [LAW] -> [LAW]                # 废止关系
- supersedes: [LAW] -> [LAW]             # 替代关系
- based_on: [REGULATION] -> [LAW]        # 行政法规基于上位法
```
**关键价值**：追踪法律演变历史，识别有效法律版本

#### 📖 二、司法解释与法规关系（Interpretation-Law Relations）
```yaml
- interprets: [JUDICIAL_INTERPRETATION] -> [LAW/ARTICLE]
- clarifies: [JUDICIAL_INTERPRETATION] -> [LEGAL_CONCEPT]
- specifies: [JUDICIAL_INTERPRETATION] -> [ARTICLE]
```
**关键价值**：连接司法解释与法条，支持法律适用的精确查找

#### ⚖️ 三、判决书与法规关系（Judgment-Law Relations）
```yaml
- cites: [JUDGMENT] -> [LAW/ARTICLE]              # 引用
- applies: [JUDGMENT] -> [ARTICLE]                # 适用（实际应用）
- refers_to: [JUDGMENT] -> [JUDICIAL_INTERPRETATION]
- invokes: [JUDGMENT] -> [LEGAL_PRINCIPLE]
```
**关键价值**：建立判决书与法律法规的引用链，支持判例检索

#### 📋 四、判决书与案件实体关系（Judgment-Case Relations）
```yaml
- accused_of: [PERSON] -> [CRIME]
- sued_for: [PERSON/ORG] -> [CAUSE_OF_ACTION]
- sentenced_to: [PERSON] -> [PUNISHMENT]
- bear_liability: [PERSON/ORG] -> [LIABILITY]
- represents: [LAWYER] -> [PERSON/ORG]
- presides: [JUDGE] -> [CASE_NUMBER]
- prosecutes: [PROCURATORATE] -> [CASE_NUMBER]
```
**关键价值**：完整表达案件的法律关系链条

#### 🔍 五、证据与事实关系（Evidence Relations）
```yaml
- proves: [EVIDENCE] -> [CRIME/LEGAL_CONCEPT]
- supports: [EVIDENCE] -> [JUDGMENT]
- contradicts: [EVIDENCE] -> [EVIDENCE]
```
**关键价值**：支持基于证据的法律推理

#### 🔗 六、案件关联关系（Case Relations）
```yaml
- similar_to: [JUDGMENT] -> [JUDGMENT]        # 类似案例
- cited_by: [JUDGMENT] -> [JUDGMENT]          # 判例引用
- appeals_from: [JUDGMENT] -> [JUDGMENT]      # 上诉关系
```
**关键价值**：建立判例网络，支持类案检索

#### 💡 七、概念关系（Concept Relations）
```yaml
- defines: [LAW] -> [LEGAL_CONCEPT]
- includes: [LEGAL_CONCEPT] -> [LEGAL_CONCEPT]
- applies_concept: [JUDGMENT] -> [LEGAL_CONCEPT]
```
**关键价值**：构建法律概念本体，支持概念推理

#### 🏢 八、组织与文档关系（Organization-Document Relations）
```yaml
- issued_by: [LAW] -> [ISSUING_AUTHORITY]
- adjudicated_by: [JUDGMENT] -> [COURT]
```
**关键价值**：追溯文档来源和权威性

---

## 🔧 提示词工程优化

### 1. 实体提取提示词增强

#### 核心改进点：
1. **文档类型识别**：首先判断文本属于哪种文档类型
2. **元数据优先**：提取案号、发文机关、生效时间等唯一标识
3. **标准化命名规则**：
   - 法律名称必须包含书名号：`《中华人民共和国刑法》`
   - 法条必须关联所属法律：`《刑法》第一百三十三条`
   - 案号必须完整：`(2023)京01刑初123号`
4. **角色明确**：对PERSON实体，在description中标注角色（被告人、原告等）
5. **引用识别**：识别文本中引用的其他法律文件，即使未完整出现

#### 新增示例场景：
- **判决书场景**：完整提取案号、法院、当事人、罪名、刑罚、引用法条
- **法律法规场景**：提取法律名称、发文机关、生效时间、法条结构
- **原有通用场景**：保留用于简单文本

### 2. 关系提取提示词增强

#### 核心改进点：
1. **跨文档关系优先**：优先识别判决书引用法条、司法解释解释法条等
2. **关系类型精确**：严格区分 `cites`(引用)、`applies`(适用)、`interprets`(解释)
3. **完整推理链**：提取从证据到判决的完整法律推理链
4. **元数据关系**：建立文档与发文机关、时间等元数据的关系

#### 关系强度评分标准（5-10分）：
- **10分**：直接从属关系（法条属于法律、判决适用法条）
- **9分**：同一实体的不同表现（法律的修订版本）
- **8分**：紧密关联（被告人与罪名、证据与判决）
- **7分**：明确但非直接（判决引用司法解释）
- **6分**：间接关联（类似案例）
- **5分**：松散关联（相同领域的不同概念）

---

## 📊 应用场景示例

### 场景1：从判决书追溯到法条
```
用户查询：(2023)京01刑初123号判决依据的法律是什么？

知识图谱查询路径：
(2023)京01刑初123号 --applies--> 《刑法》第一百三十三条之一
《刑法》第一百三十三条之一 --belongs_to--> 《中华人民共和国刑法》
《中华人民共和国刑法》 --issued_by--> 全国人民代表大会
```

### 场景2：从法条查找适用案例
```
用户查询：《刑法》第一百三十三条之一有哪些适用案例？

知识图谱查询路径：
《刑法》第一百三十三条之一 <--applies-- [判决书1, 判决书2, ...]
```

### 场景3：查找司法解释
```
用户查询：危险驾驶罪的司法解释是什么？

知识图谱查询路径：
危险驾驶罪 <--accused_of-- 被告人
被告人 <--sentenced_to-- 判决书
判决书 --refers_to--> 司法解释
司法解释 --interprets--> 《刑法》第一百三十三条之一
```

### 场景4：类案检索
```
用户查询：与(2023)京01刑初123号类似的案件有哪些？

知识图谱查询路径：
(2023)京01刑初123号 --similar_to--> [其他判决书]
(2023)京01刑初123号 --applies--> 《刑法》某条
《刑法》某条 <--applies-- [其他适用相同法条的判决书]
```

---

## 🚀 实施建议

### 1. 分阶段实施
- **第一阶段**：实现判决书的实体和关系提取
- **第二阶段**：实现法律法规的实体和关系提取
- **第三阶段**：实现司法解释的实体和关系提取
- **第四阶段**：建立跨文档源的关系链接
- **第五阶段**：优化和验证统一知识图谱

### 2. 数据质量控制
- **实体标准化**：建立法律名称、案号等的标准化词典
- **关系验证**：通过规则验证关系的合理性（如法条不能属于判决书）
- **人工抽查**：定期抽查提取结果的准确性

### 3. 性能优化
- **批量处理**：对同类文档批量提取
- **增量更新**：新文档只提取增量实体和关系
- **索引优化**：为高频查询路径建立专门索引

### 4. 可扩展性
- **预留实体类型**：如行政处罚决定书、仲裁裁决书等
- **预留关系类型**：如overrules（推翻）、distinguishes（区分）等
- **支持多层级**：支持更细粒度的法条层级（款、项、目）

---

## 📝 配置文件位置

修改后的配置文件位于：
```
d:\workdir\ai\code\WeKnora\config\config.yaml
```

主要修改的配置项：
1. `conversation.summary.extract_entities_prompt` - 实体提取提示词
2. `conversation.summary.extract_relationships_prompt` - 关系提取提示词
3. `extract.extract_graph.tags` - 关系类型标签

---

## 🎓 最佳实践

### 1. 实体命名规范
- ✅ **推荐**：`《中华人民共和国刑法》`、`(2023)京01刑初123号`
- ❌ **避免**：`刑法`、`京01刑初123号`

### 2. 关系描述规范
- ✅ **推荐**：`判决书适用《刑法》第一百三十三条之一认定危险驾驶罪`
- ❌ **避免**：`引用法条`

### 3. 角色标注规范
- ✅ **推荐**：`{"title": "张三", "type": "PERSON", "description": "被告人，男，1985年生"}`
- ❌ **避免**：`{"title": "张三", "type": "PERSON", "description": "张三"}`

### 4. 引用识别技巧
- 识别简称：`刑法` → `《中华人民共和国刑法》`
- 识别隐含引用：`本法第X条` → 根据上下文确定具体法律
- 识别条款引用：`第一款` → 结合上文确定具体条文

---

## 🔍 验证方法

### 1. 实体提取验证
```python
# 检查是否提取了文档类型实体（判决书/法律/司法解释）
assert any(e['type'] in ['JUDGMENT', 'LAW', 'JUDICIAL_INTERPRETATION'] for e in entities)

# 检查法律名称是否包含书名号
law_entities = [e for e in entities if e['type'] == 'LAW']
assert all(e['title'].startswith('《') and e['title'].endswith('》') for e in law_entities)

# 检查PERSON实体是否标注了角色
person_entities = [e for e in entities if e['type'] == 'PERSON']
assert all('被告人' in e['description'] or '原告' in e['description'] or 
           '证人' in e['description'] or '法官' in e['description'] 
           for e in person_entities)
```

### 2. 关系提取验证
```python
# 检查是否存在跨文档关系
cross_doc_relations = ['cites', 'applies', 'interprets', 'refers_to']
assert any(r['type'] in cross_doc_relations for r in relations)

# 检查法条是否正确归属于法律
article_belongs = [r for r in relations if r['type'] == 'belongs_to']
for r in article_belongs:
    assert entities[r['source']]['type'] == 'ARTICLE'
    assert entities[r['target']]['type'] in ['LAW', 'REGULATION']

# 检查关系强度是否合理
assert all(5 <= r['strength'] <= 10 for r in relations)
```

### 3. 完整性验证
```python
# 判决书必须包含案号
if document_type == 'JUDGMENT':
    assert any(e['type'] == 'CASE_NUMBER' for e in entities)
    
# 判决书必须包含法院
if document_type == 'JUDGMENT':
    assert any(e['type'] == 'COURT' for e in entities)

# 判决书必须引用法条
if document_type == 'JUDGMENT':
    assert any(r['type'] in ['cites', 'applies'] for r in relations)
```

---

## 💡 常见问题

### Q1: 如何处理同一法律的不同版本？
**A**: 使用 `amends` 关系连接不同版本，并在 `VALIDITY_STATUS` 实体中标注时效状态。

### Q2: 如何处理法条的简称（如"刑法第133条"）？
**A**: 在实体提取时统一规范化为 `《刑法》第一百三十三条`，建立简称映射表。

### Q3: 如何区分 `cites`（引用）和 `applies`（适用）？
**A**: 
- `cites`: 判决书中提到但未实际适用的法条
- `applies`: 判决书实际依据并适用于判决结果的法条

### Q4: 如何处理一个判决书引用多个法条的情况？
**A**: 为每个引用的法条建立独立的关系，使用不同的关系强度区分主要法条和辅助法条。

### Q5: 如何保证不同文档中的同一实体被正确关联？
**A**: 
1. 使用唯一标识（如案号、法律全称）
2. 建立实体消歧机制
3. 定期运行实体链接算法

---

## 📚 参考资料

1. 《中国裁判文书网数据分析报告》
2. 《法律知识图谱构建方法研究》
3. 《司法大数据应用实践指南》
4. WeKnora项目官方文档

---

## 📧 联系方式

如有问题或建议，请提交Issue或联系项目维护者。

---

**最后更新时间**: 2025-12-30
**文档版本**: v1.0
**配置版本**: WeKnora统一知识图谱版
