# WeKnora å¼€å‘æŒ‡å—

æœ¬æŒ‡å—å°†å¸®åŠ©ä½ å¿«é€Ÿå¼€å§‹ WeKnora çš„å¼€å‘å·¥ä½œã€‚

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [æƒé™ç®¡ç†ç³»ç»Ÿ](./æƒé™ç®¡ç†ç³»ç»Ÿ.md) - ç”¨æˆ·è§’è‰²å’Œæƒé™é…ç½®æŒ‡å—
- [çŸ¥è¯†å›¾è°±åŠŸèƒ½](./å¼€å¯çŸ¥è¯†å›¾è°±åŠŸèƒ½.md) - çŸ¥è¯†å›¾è°±é…ç½®è¯´æ˜
- [MCPåŠŸèƒ½ä½¿ç”¨](./MCPåŠŸèƒ½ä½¿ç”¨è¯´æ˜.md) - MCPå·¥å…·é›†æˆæŒ‡å—
- [APIå‚è€ƒæ–‡æ¡£](./api/README.md) - APIæ¥å£æ–‡æ¡£

## å¿«é€Ÿå¼€å‘æ¨¡å¼ï¼ˆæ¨èï¼‰

å¦‚æœä½ éœ€è¦é¢‘ç¹ä¿®æ”¹ `app` æˆ– `frontend` ä»£ç ï¼Œ**ä¸éœ€è¦æ¯æ¬¡éƒ½é‡æ–°æ„å»º Docker é•œåƒ**ï¼Œå¯ä»¥ä½¿ç”¨æœ¬åœ°å¼€å‘æ¨¡å¼ã€‚

### æ–¹å¼ä¸€ï¼šä½¿ç”¨ Make å‘½ä»¤ï¼ˆæ¨èï¼‰

#### 1. å¯åŠ¨åŸºç¡€è®¾æ–½æœåŠ¡

```bash
make dev-start
```

è¿™å°†å¯åŠ¨ä»¥ä¸‹æœåŠ¡çš„ Docker å®¹å™¨ï¼š
- PostgreSQLï¼ˆæ•°æ®åº“ï¼‰
- Redisï¼ˆç¼“å­˜ï¼‰
- MinIOï¼ˆå¯¹è±¡å­˜å‚¨ï¼‰
- Neo4jï¼ˆå›¾æ•°æ®åº“ï¼‰
- DocReaderï¼ˆæ–‡æ¡£è¯»å–æœåŠ¡ï¼‰
- Jaegerï¼ˆé“¾è·¯è¿½è¸ªï¼‰

#### 2. å¯åŠ¨åç«¯åº”ç”¨ï¼ˆæ–°ç»ˆç«¯ï¼‰

```bash
make dev-app
```

è¿™å°†åœ¨æœ¬åœ°ç›´æ¥è¿è¡Œ Go åº”ç”¨ï¼Œä¿®æ”¹ä»£ç å Ctrl+C åœæ­¢ï¼Œé‡æ–°è¿è¡Œå³å¯ã€‚

#### 3. å¯åŠ¨å‰ç«¯ï¼ˆæ–°ç»ˆç«¯ï¼‰

```bash
make dev-frontend
```

è¿™å°†å¯åŠ¨ Vite å¼€å‘æœåŠ¡å™¨ï¼Œæ”¯æŒçƒ­é‡è½½ï¼Œä¿®æ”¹ä»£ç åè‡ªåŠ¨åˆ·æ–°ã€‚

#### 4. æŸ¥çœ‹æœåŠ¡çŠ¶æ€

```bash
make dev-status
```

#### 5. åœæ­¢æ‰€æœ‰æœåŠ¡

```bash
make dev-stop
```

### æ–¹å¼äºŒï¼šä½¿ç”¨è„šæœ¬å‘½ä»¤

å¦‚æœä½ æ›´å–œæ¬¢ç›´æ¥ä½¿ç”¨è„šæœ¬ï¼š

```bash
# å¯åŠ¨åŸºç¡€è®¾æ–½
./scripts/dev.sh start

# å¯åŠ¨åç«¯ï¼ˆæ–°ç»ˆç«¯ï¼‰
./scripts/dev.sh app

# å¯åŠ¨å‰ç«¯ï¼ˆæ–°ç»ˆç«¯ï¼‰
./scripts/dev.sh frontend

# æŸ¥çœ‹æ—¥å¿—
./scripts/dev.sh logs

# åœæ­¢æ‰€æœ‰æœåŠ¡
./scripts/dev.sh stop
```

## è®¿é—®åœ°å€

### å¼€å‘ç¯å¢ƒ

- **å‰ç«¯å¼€å‘æœåŠ¡å™¨**: http://localhost:5173
- **åç«¯ API**: http://localhost:8080
- **PostgreSQL**: localhost:5432
- **Redis**: localhost:6379
- **MinIO Console**: http://localhost:9001
- **Neo4j Browser**: http://localhost:7474
- **Jaeger UI**: http://localhost:16686

## å¼€å‘å·¥ä½œæµå¯¹æ¯”

### âŒ æ—§æ–¹å¼ï¼ˆæ…¢ï¼‰

```bash
# æ¯æ¬¡ä¿®æ”¹ä»£ç åéƒ½éœ€è¦ï¼š
sh scripts/build_images.sh -p      # é‡æ–°æ„å»ºé•œåƒï¼ˆå¾ˆæ…¢ï¼‰
sh scripts/start_all.sh --no-pull  # é‡å¯å®¹å™¨
```

**è€—æ—¶**ï¼šæ¯æ¬¡ä¿®æ”¹éœ€è¦ 2-5 åˆ†é’Ÿ

### âœ… æ–°æ–¹å¼ï¼ˆå¿«ï¼‰

```bash
# é¦–æ¬¡å¯åŠ¨ï¼ˆåªéœ€è¦ä¸€æ¬¡ï¼‰ï¼š
make dev-start

# åœ¨å¦å¤–ä¸¤ä¸ªç»ˆç«¯åˆ†åˆ«è¿è¡Œï¼š
make dev-app       # ä¿®æ”¹ Go ä»£ç å Ctrl+C é‡å¯å³å¯ï¼ˆç§’çº§ï¼‰
make dev-frontend  # ä¿®æ”¹å‰ç«¯ä»£ç è‡ªåŠ¨çƒ­é‡è½½ï¼ˆæ— éœ€é‡å¯ï¼‰
```

**è€—æ—¶**ï¼š
- é¦–æ¬¡å¯åŠ¨ï¼š1-2 åˆ†é’Ÿ
- åç»­ä¿®æ”¹åç«¯ï¼š5-10 ç§’ï¼ˆé‡å¯ Go åº”ç”¨ï¼‰
- åç»­ä¿®æ”¹å‰ç«¯ï¼šå®æ—¶çƒ­é‡è½½

## ä½¿ç”¨ Air å®ç°åç«¯çƒ­é‡è½½ï¼ˆå¯é€‰ï¼‰

å¦‚æœä½ å¸Œæœ›åç«¯ä»£ç ä¿®æ”¹åä¹Ÿèƒ½è‡ªåŠ¨é‡å¯ï¼Œå¯ä»¥å®‰è£… `air`ï¼š

### 1. å®‰è£… Air

```bash
go install github.com/cosmtrek/air@latest
```

### 2. åˆ›å»ºé…ç½®æ–‡ä»¶

åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `.air.toml`ï¼š

```toml
root = "."
testdata_dir = "testdata"
tmp_dir = "tmp"

[build]
  args_bin = []
  bin = "./tmp/main"
  cmd = "go build -o ./tmp/main ./cmd/server"
  delay = 1000
  exclude_dir = ["assets", "tmp", "vendor", "testdata", "frontend", "migrations"]
  exclude_file = []
  exclude_regex = ["_test.go"]
  exclude_unchanged = false
  follow_symlink = false
  full_bin = ""
  include_dir = []
  include_ext = ["go", "tpl", "tmpl", "html", "yaml"]
  include_file = []
  kill_delay = "0s"
  log = "build-errors.log"
  poll = false
  poll_interval = 0
  rerun = false
  rerun_delay = 500
  send_interrupt = false
  stop_on_error = false

[color]
  app = ""
  build = "yellow"
  main = "magenta"
  runner = "green"
  watcher = "cyan"

[log]
  main_only = false
  time = false

[misc]
  clean_on_exit = false

[screen]
  clear_on_rebuild = false
  keep_scroll = true
```

### 3. ä½¿ç”¨ Air å¯åŠ¨

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•
air
```

ç°åœ¨ä¿®æ”¹ Go ä»£ç åä¼šè‡ªåŠ¨é‡æ–°ç¼–è¯‘å’Œé‡å¯ï¼

## å…¶ä»–å¼€å‘æŠ€å·§

### åªä¿®æ”¹å‰ç«¯

å¦‚æœåªä¿®æ”¹å‰ç«¯ï¼Œåªéœ€è¦ï¼š

```bash
cd frontend
npm run dev
```

å‰ç«¯ä¼šè¿æ¥åˆ° http://localhost:8080 çš„åç«¯ APIã€‚

### åªä¿®æ”¹åç«¯

å¦‚æœåªä¿®æ”¹åç«¯ï¼Œåªéœ€è¦ï¼š

```bash
# å¯åŠ¨åŸºç¡€è®¾æ–½
make dev-start

# è¿è¡Œåç«¯
make dev-app
```

### è°ƒè¯•æ¨¡å¼

#### åç«¯è°ƒè¯•

ä½¿ç”¨ VS Code æˆ– GoLand çš„è°ƒè¯•åŠŸèƒ½ï¼Œé…ç½®è¿æ¥åˆ°æœ¬åœ°è¿è¡Œçš„ Go åº”ç”¨ã€‚

VS Code é…ç½®ç¤ºä¾‹ï¼ˆ`.vscode/launch.json`ï¼‰ï¼š

```json
{
    "version": "0.2.0",
    "configurations": [
        {
            "name": "Launch Server",
            "type": "go",
            "request": "launch",
            "mode": "auto",
            "program": "${workspaceFolder}/cmd/server",
            "env": {
                "DB_HOST": "localhost",
                "DOCREADER_ADDR": "localhost:50051",
                "MINIO_ENDPOINT": "localhost:9000",
                "REDIS_ADDR": "localhost:6379",
                "OTEL_EXPORTER_OTLP_ENDPOINT": "localhost:4317",
                "NEO4J_URI": "bolt://localhost:7687"
            },
            "args": []
        }
    ]
}
```

#### å‰ç«¯è°ƒè¯•

ä½¿ç”¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·å³å¯ï¼ŒVite æä¾›äº† source mapã€‚

## ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

å½“ä½ å®Œæˆå¼€å‘éœ€è¦éƒ¨ç½²æ—¶ï¼Œæ‰éœ€è¦æ„å»ºé•œåƒï¼š

```bash
# æ„å»ºæ‰€æœ‰é•œåƒ
sh scripts/build_images.sh

# æˆ–åªæ„å»ºç‰¹å®šé•œåƒ
sh scripts/build_images.sh -p  # åªæ„å»ºåç«¯
sh scripts/build_images.sh -f  # åªæ„å»ºå‰ç«¯

# å¯åŠ¨ç”Ÿäº§ç¯å¢ƒ
sh scripts/start_all.sh
```

## å¸¸è§é—®é¢˜

### Q: å¯åŠ¨ dev-app æ—¶æŠ¥é”™è¿æ¥ä¸åˆ°æ•°æ®åº“

A: ç¡®ä¿å…ˆè¿è¡Œäº† `make dev-start`ï¼Œå¹¶ç­‰å¾…æ‰€æœ‰æœåŠ¡å¯åŠ¨å®Œæˆï¼ˆå¤§çº¦ 30 ç§’ï¼‰ã€‚

### Q: å‰ç«¯è®¿é—® API æ—¶æŠ¥ CORS é”™è¯¯

A: æ£€æŸ¥å‰ç«¯çš„ä»£ç†é…ç½®ï¼Œç¡®ä¿ `vite.config.ts` ä¸­é…ç½®äº†æ­£ç¡®çš„ä»£ç†ã€‚

### Q: DocReader æœåŠ¡éœ€è¦é‡æ–°æ„å»ºæ€ä¹ˆåŠï¼Ÿ

A: DocReader ä»ç„¶ä½¿ç”¨ Docker é•œåƒï¼Œå¦‚æœéœ€è¦ä¿®æ”¹ï¼Œéœ€è¦é‡æ–°æ„å»ºï¼š

```bash
sh scripts/build_images.sh -d
make dev-restart
```

## æ€»ç»“

- **æ—¥å¸¸å¼€å‘**ï¼šä½¿ç”¨ `make dev-*` å‘½ä»¤ï¼Œå¿«é€Ÿè¿­ä»£
- **æµ‹è¯•é›†æˆ**ï¼šä½¿ç”¨ `sh scripts/start_all.sh --no-pull` æµ‹è¯•å®Œæ•´ç¯å¢ƒ
- **ç”Ÿäº§éƒ¨ç½²**ï¼šä½¿ç”¨ `sh scripts/build_images.sh` + `sh scripts/start_all.sh`

